<div class="place-detail">
  <div *ngIf="loading" class="loading">ğŸŒ¿ Cargando detallesâ€¦</div>
  <div *ngIf="error" class="error">âš ï¸ {{ error }}</div>

  <div *ngIf="place" class="detail-container">
    <!-- Header con imagen principal -->
    <div class="hero" [style.background-image]="place.photos && place.photos.length > 0 ? 'url(' + place.photos[0].url + ')' : 'url(https://via.placeholder.com/1200x400?text=Sin+Imagen)'">
      <div class="hero-overlay">
        <a routerLink="/admin/places-list" class="btn-back">â† Volver</a>
        <h1 class="hero-title">{{ place.name }}</h1>
        <span class="hero-badge">{{ place.category }}</span>
      </div>
    </div>

    <div class="content-wrapper">
      <!-- DescripciÃ³n -->
      <section class="section">
        <h2 class="section-title">ğŸ“ DescripciÃ³n</h2>
        <p class="description">{{ place.description }}</p>
      </section>

      <!-- InformaciÃ³n general -->
      <section class="section">
        <h2 class="section-title">â„¹ï¸ InformaciÃ³n General</h2>
        <div class="info-grid">
          <div class="info-card">
            <span class="icon">ğŸ“</span>
            <div>
              <strong>UbicaciÃ³n</strong>
              <p>{{ place.latitude.toFixed(4) }}, {{ place.longitude.toFixed(4) }}</p>
            </div>
          </div>
          <div class="info-card">
            <span class="icon">ğŸ”ï¸</span>
            <div>
              <strong>ElevaciÃ³n</strong>
              <p>{{ place.elevationMeters }} m</p>
            </div>
          </div>
          <div class="info-card">
            <span class="icon">â™¿</span>
            <div>
              <strong>Accesibilidad</strong>
              <p>{{ place.accessible ? 'Accesible' : 'No accesible' }}</p>
            </div>
          </div>
          <div class="info-card">
            <span class="icon">ğŸ’µ</span>
            <div>
              <strong>Entrada</strong>
              <p>{{ place.entryFee === 0 ? 'Gratis' : (place.entryFee | currency:'USD') }}</p>
            </div>
          </div>
          <div class="info-card">
            <span class="icon">ğŸ•</span>
            <div>
              <strong>Horario</strong>
              <p>{{ place.openingHours }}</p>
            </div>
          </div>
        </div>
      </section>

      <!-- GalerÃ­a de fotos -->
      <section class="section" *ngIf="place.photos && place.photos.length > 0">
        <h2 class="section-title">ğŸ“¸ GalerÃ­a de Fotos</h2>
        <div class="photo-gallery">
          <img *ngFor="let photo of place.photos" 
               [src]="photo.url" 
               [alt]="place.name"
               loading="lazy">
        </div>
      </section>

      <!-- Senderos -->
      <section class="section" *ngIf="place.trails && place.trails.length > 0">
        <h2 class="section-title">ğŸ¥¾ Senderos Disponibles</h2>
        <div class="trails-grid">
          <div class="trail-card" *ngFor="let trail of place.trails">
            <h3 class="trail-name">{{ trail.name }}</h3>
            <div class="trail-info">
              <span class="trail-badge" [ngClass]="{
                'difficulty-baja': trail.difficulty.toLowerCase() === 'baja',
                'difficulty-media': trail.difficulty.toLowerCase() === 'media',
                'difficulty-alta': trail.difficulty.toLowerCase() === 'alta'
              }">{{ trail.difficulty }}</span>
              <span class="trail-badge loop">{{ trail.isLoop ? 'ğŸ” Circuito' : 'â¡ï¸ Lineal' }}</span>
            </div>
            <div class="trail-stats">
              <div><strong>ğŸ“</strong> {{ trail.distanceKm }} km</div>
              <div><strong>â±ï¸</strong> {{ trail.estimatedTimeMinutes }} min</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Amenidades -->
      <section class="section" *ngIf="place.amenities && place.amenities.length > 0">
        <h2 class="section-title">âœ¨ Amenidades</h2>
        <div class="amenities">
          <span class="amenity-badge" *ngFor="let amenity of place.amenities">
            âœ“ {{ amenity.name }}
          </span>
        </div>
      </section>

      <!-- AnÃ¡lisis con IA -->
      <section class="section ai-section">
        <div class="ai-header">
          <h2 class="section-title">ğŸ¤– AnÃ¡lisis Inteligente</h2>
          <button class="btn-ai" (click)="toggleAiAnalysis()" [disabled]="aiLoading">
            {{ showAiAnalysis ? 'ğŸ”½ Ocultar' : 'ğŸ” Analizar con IA' }}
          </button>
        </div>

        <div *ngIf="showAiAnalysis" class="ai-content">
          <div *ngIf="aiLoading" class="ai-loading">
            <div class="spinner"></div>
            <p>ğŸ§  Analizando todos los lugares con IA...</p>
          </div>

          <div *ngIf="aiError" class="ai-error">
            <span class="error-icon">âš ï¸</span>
            <p>{{ aiError }}</p>
          </div>

          <div *ngIf="!aiLoading && !aiError && aiAnalysis" class="ai-results">
            <!-- Si la respuesta tiene estructura JSON -->
            <div *ngIf="aiAnalysis.generalStats" class="ai-structured">
              <div class="stats-card" *ngIf="aiAnalysis.generalStats">
                <h3>ğŸ“Š EstadÃ­sticas Generales</h3>
                <div class="stats-grid">
                  <div class="stat-item" *ngFor="let stat of objectKeys(aiAnalysis.generalStats)">
                    <strong>{{ formatKey(stat) }}:</strong>
                    <span>{{ aiAnalysis.generalStats[stat] }}</span>
                  </div>
                </div>
              </div>

              <div class="recommendations-card" *ngIf="aiAnalysis.recommendations">
                <h3>ğŸ’¡ Recomendaciones</h3>
                <ul>
                  <li *ngFor="let rec of aiAnalysis.recommendations">{{ rec }}</li>
                </ul>
              </div>

              <div class="insights-card" *ngIf="aiAnalysis.insights">
                <h3>ğŸ¯ Insights</h3>
                <ul>
                  <li *ngFor="let insight of aiAnalysis.insights">{{ insight }}</li>
                </ul>
              </div>

              <div class="top-places-card" *ngIf="aiAnalysis.topPlaces">
                <h3>ğŸ† Lugares Destacados</h3>
                <div class="top-place" *ngFor="let place of aiAnalysis.topPlaces">
                  <h4>{{ place.name }}</h4>
                  <p>{{ place.reason }}</p>
                </div>
              </div>
            </div>

            <!-- Si la respuesta es texto plano -->
            <div *ngIf="aiAnalysis.response" class="ai-text">
              <pre>{{ aiAnalysis.response }}</pre>
            </div>

            <!-- Fallback: mostrar JSON completo -->
            <div *ngIf="!aiAnalysis.generalStats && !aiAnalysis.response" class="ai-json">
              <pre>{{ aiAnalysis | json }}</pre>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>
</div>
